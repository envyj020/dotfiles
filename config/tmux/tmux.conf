# vim:fileencoding=utf-8:ft=tmux:foldmethod=marker

#: VARS/ENV {{{

set-environment -gF TMUX_CONFIG_DIR "#{XDG_CONFIG_HOME}/tmux"
set-environment -gF TMUX_RESURRECT_DIR "#{XDG_DATA_HOME}/tmux/resurrect"
set-environment -g KUBE_TMUX_SYMBOL_ENABLE false

#: }}}

#: TMUX PREFIX {{{
#: <C-a>

unbind C-b
set -g prefix C-a
bind C-a send-prefix

#: }}}

#: GLOBAL SETTINGS {{{

set -g base-index 1
set -g pane-base-index 1
set -g set-clipboard on
set -g focus-events on
set -g pane-border-status off
set -g automatic-rename on
set -g renumber-window on
set -g allow-rename off
set -g wrap-search on
set -g monitor-bell off
set -g allow-passthrough on
set -g lock-after-time 0
set -g visual-activity off
set -g history-limit 30000
set -g display-time 3000
set -g status-interval 5
set -g status-position bottom

set -g default-shell "/bin/bash"
set -g default-command "exec /bin/bash"

set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",alacritty:Tc"
set -ga terminal-overrides ",xterm-256color:Tc"

#: }}}

#: USER DEFINED COMMANDS {{{

set -s command-alias[10] repane='select-pane -T'
set -s command-alias[11] rewindow='rename-window'

#: }}}

#: MISC KEYBINDINGS {{{

bind h set -g mouse on \; run-shell "notify-send -i input-mouse -u low -t 1000 'Mouse mode on'"
bind H set -g mouse off \; run-shell "notify-send -i changes-prevent -u low -t 1000 'Mouse mode off'"

bind e set -w synchronize-panes on \; run-shell "notify-send -i state_running -u low -t 1000 'Panes synchronization on'"
bind E set -w synchronize-panes off \; run-shell "notify-send -i state_paused  -u low -t 1000 'Panes synchronization off'"

#: }}}

#: WINDOW KEYBINDINGS {{{

bind -n C-Left previous-window
bind -n C-Right next-window

bind C-w command-prompt -p "Window name:" "new-window -n '%%'"
bind C-, command-prompt -I "#W" "rename-window '%%'"

#: }}}

#: PANE KEYBINDINGS {{{

bind | split-window -h -c '#{pane_current_path}'
bind - split-window -v -c '#{pane_current_path}'

bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

bind -r Up resize-pane -U 5
bind -r Down resize-pane -D 5
bind -r Left resize-pane -L 5
bind -r Right resize-pane -R 5

#: }}}

#: UNBINDINGS {{{

unbind '"'
unbind %

unbind C-Up
unbind C-Down
unbind p
unbind n

#: }}}

#: PLUGINS

#: CATPPUCCIN BORDER STATUS {{{

set -g @catppuccin_flavor 'mocha'
set -g @catppuccin_status_background 'none'

set -g status-justify 'absolute-centre'
set -g status-right-length 100
set -g status-left-length 100

#: BORDERS
set -g @catppuccin_pane_status_enabled 'no'
set -g @catppuccin_pane_border_status 'no'
set -g @catppuccin_pane_number_position 'right'
set -g @catppuccin_pane_default_text "#P"

#: CENTRE
set -g @catppuccin_window_status_style 'basic'
set -g @catppuccin_window_number_position 'right'
set -g @catppuccin_window_status 'no'
set -g @catppuccin_window_text "#I"
set -g @catppuccin_window_current_text "#I"
set -g @catppuccin_window_current_text_color "#{@thm_surface_1}"
set -g @catppuccin_window_number "#P"
set -g @catppuccin_window_number_color "#{@thm_mauve}"
set -g @catppuccin_window_current_number "#P"
set -g @catppuccin_window_current_number_color "#{@thm_peach}"

set -g @catppuccin_status_left_separator ""
set -g @catppuccin_status_right_separator ""
set -g @catppuccin_status_middle_separator ""

#: SEPARATOR
set -g @catppuccin_status_separator_icon_fg "#{@thm_surface_2}"

#: LEFT
set -g @catppuccin_status_session_prefix_color "#{@thm_bg}"
set -g @catppuccin_status_session_prefix_text_bg "#{@thm_bg}"
set -g @catppuccin_status_session_prefix_text_fg "#{@thm_peach}"

set -g @catppuccin_status_window_name_text_bg "#{@thm_bg}"
set -g @catppuccin_status_window_name_icon_fg "#{@thm_green}"
set -g @catppuccin_status_window_name_text_fg "#{@thm_green}"

set -g @catppuccin_directory_icon " "
set -g @catppuccin_directory_color "#{@thm_bg}"
set -g @catppuccin_status_directory_text_bg "#{@thm_bg}"
set -g @catppuccin_status_directory_icon_fg "#{@thm_blue}"
set -g @catppuccin_status_directory_text_fg "#{@thm_blue}"

set -g @catppuccin_kube_context_color "#{@thm_red}"
set -g @catppuccin_kube_namespace_color "#{@thm_peach}"
set -g @catppuccin_kube_color "#{@thm_bg}"
set -g @catppuccin_status_kube_icon_fg "#{@thm_blue}"
set -g @catppuccin_status_kube_text_bg "#{@thm_bg}"

set -g @catppuccin_status_zoom_icon_bg "#{@thm_bg}"
set -g @catppuccin_status_zoom_text_bg "#{@thm_bg}"
set -g @catppuccin_status_zoom_icon_fg "#{@thm_yellow}"
set -g @catppuccin_status_zoom_text_fg "#{@thm_yellow}"

#: RIGHT
set -g @catppuccin_status_user_and_host_icon_bg "#{@thm_bg}"
set -g @catppuccin_status_user_and_host_text_bg "#{@thm_bg}"
set -g @catppuccin_status_user_and_host_icon_fg "#{@thm_peach}"
set -g @catppuccin_status_user_and_host_text_fg "#{@thm_peach}"

set -g @catppuccin_battery_icon "󱐋"
set -g @catppuccin_status_battery_icon_bg "#{@thm_bg}"
set -g @catppuccin_status_battery_text_bg "#{@thm_bg}"
set -g @catppuccin_status_battery_icon_fg "#{@thm_blue}"
set -g @catppuccin_status_battery_text_fg "#{@thm_blue}"

set -g @catppuccin_status_uptime_icon_bg "#{@thm_bg}"
set -g @catppuccin_status_uptime_text_bg "#{@thm_bg}"
set -g @catppuccin_status_uptime_icon_fg "#{@thm_red}"
set -g @catppuccin_status_uptime_text_fg "#{@thm_red}"

set -g @catppuccin_date_time_text " %Y-%m-%d 󰅐 %H:%M "
set -g @catppuccin_date_time_icon "󰃭"
set -g @catppuccin_date_time_color "#{@thm_bg}"
set -g @catppuccin_status_date_time_icon_fg "#{@thm_flamingo}"
set -g @catppuccin_status_date_time_text_fg "#{@thm_flamingo}"
set -g @catppuccin_status_date_time_text_bg "#{@thm_bg}"

run '#{TMUX_CONFIG_DIR}/plugins/tmux/catppuccin.tmux'

#: CUSTOM MODULES
source -F '#{TMUX_CONFIG_DIR}/catppuccin_modules/user_and_host.conf'
source -F '#{TMUX_CONFIG_DIR}/catppuccin_modules/session_prefix.conf'
source -F '#{TMUX_CONFIG_DIR}/catppuccin_modules/window_name.conf'
source -F '#{TMUX_CONFIG_DIR}/catppuccin_modules/separator.conf'
source -F '#{TMUX_CONFIG_DIR}/catppuccin_modules/zoom.conf'

set -g status-left "#{E:@catppuccin_status_session_prefix}"
set -ga status-left "#{E:@catppuccin_status_separator}"
set -ga status-left "#{E:@catppuccin_status_window_name}"
set -ga status-left "#{E:@catppuccin_status_separator}"
set -ga status-left "#{E:@catppuccin_status_kube}"
set -ga status-left "#{?window_zoomed_flag,#{E:@catppuccin_status_separator}#{E:@catppuccin_status_zoom},}"

set -g status-right "#{E:@catppuccin_status_user_and_host}"
set -ga status-right "#{E:@catppuccin_status_separator}"
set -gaF status-right "#{E:@catppuccin_status_battery}"
set -ga status-right "#{E:@catppuccin_status_separator}"
set -ga status-right "#{E:@catppuccin_status_uptime}"

run '#{TMUX_CONFIG_DIR}/plugins/tmux/catppuccin.tmux'

#: }}}

#: PLUGINS {{{

set -g @plugin 'jonmosco/kube-tmux'
set -g @plugin 'catppuccin/tmux#v2.1.3'

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-copycat'
set -g @plugin 'tmux-plugins/tmux-yank'

#: save: prefix + <C-s>
#: restore: prefix + <C-r>
set -g @resurrect-strategy-vim 'session'
set -g @resurrect-strategy-nvim 'session'

set -g @continuum-save-interval '5'
set -g @continuum-restore 'on'
set -g @continuum-boot 'on'
set -g @continuum-boot-options 'alacritty,fullscreen'

set -g @plugin 'nhdaly/tmux-better-mouse-mode'
set -g @plugin 'joshmedeski/tmux-nerd-font-window-name'
set -g @plugin 'b0o/tmux-autoreload'
set -g @tmux-autoreload-quiet 1

#: open: prefix + T
set -g @plugin '27medkamal/tmux-session-wizard'
set -g @session-wizard-mode 'short-path'
set -g @session-wizard-height 30
set -g @session-wizard-width 40
set -g @session-wizard-windows on

#: copy mode: prefix + [
#: selection: arrows and space
#: yank: enter or y
#: paste: prefix + ]
#: open: S over text
set -g @plugin 'tmux-plugins/tmux-open'
set -g @open-S 'https://www.google.com/search?q='

#: cut pane: prefix + <Alt-x>
#: paste pane: prefix + <Alt-v>
set -g @plugin 'kristopolous/tmux-gentrify'

#: open fzf: prefix + Tab
#: copy: Enter
#: insert: Tab
set -g @plugin 'laktak/extrakto'
set -g @extrakto_popup_size 50%

#: enable: prefix + m
#: cancel: prefix + M
#: enable and focus: prefix + <Alt-m>
set -g @plugin 'rickstaa/tmux-notify'
set -g @tnotify-verbose 'on'
set -g @tnotify-prompt-suffixes '❯,✗'
set -g @tnotify-sleep-duration '5'
set -g @tnotify-verbose-title 'Task finished'
set -g @tnotify-verbose-msg 'Session: #S - Window: #I - Pane: #P'

#: INIT TMUX PACKAGE MANAGER AND SOURCE PLUGINS
run '#{TMUX_CONFIG_DIR}/plugins/tpm/tpm'

#: }}}

#: HOOKS {{{

set-hook -g window-renamed \
    'if-shell "[ #{b:pane_current_command} = nvim ]" {
        set -g popup-style "bg=#{@thm_bg}"
        set -g status-style bg="#{@thm_bg}"
        set -g message-style "bg=#{@thm_bg}"
        set -g message-command-style "bg=#{@thm_bg}"
        set -g status-position top
} {
        set -g popup-style bg=default
        set -g status-style bg=default
        set -g message-style bg=default
        set -g message-command-style bg=default
        set -g status-position bottom
}'

#: }}}
